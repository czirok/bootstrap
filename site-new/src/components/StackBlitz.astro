---
import { getConfig } from '@libs/config'
import jsSnippetContent from '@assets/snippets.js?raw'

const cdnCss = getConfig().cdn.css
const cdnJs = getConfig().cdn.js_bundle
const docsVersion = getConfig().docs_version
---

<script is:inline src="https://cdn.jsdelivr.net/npm/@stackblitz/sdk@1/bundles/sdk.umd.js"></script>

<script define:vars={{ cdnCss, cdnJs, docsVersion, jsSnippetContent }}>
  document.querySelectorAll('.btn-edit').forEach((btn) => {
    btn.addEventListener('click', (event) => {
      if (!(event.target instanceof Element)) {
        return
      }

      const snippetElement = event.target.closest('.bd-code-snippet')

      if (!snippetElement) {
        return
      }

      const exampleElement = snippetElement.querySelector('.bd-example')

      if (!exampleElement) {
        return
      }

      const htmlSnippet = exampleElement.innerHTML.trim()
      // Get extra classes for this example.
      const classes = exampleElement.getAttribute('class')
      const addJsSnippet = snippetElement.querySelector('.btn-edit')?.getAttribute('data-sb-js-snippet') != null

      const markup = `<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="${cdnCss}" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/${docsVersion}/assets/css/docs.css" rel="stylesheet">
    <title>Bootstrap Example</title>
    <script src="${cdnJs}"><\/script>
  </head>
  <body class="p-3 m-0 border-0 ${classes}">

    <!-- Example Code -->

${htmlSnippet.replace(/^/gm, '    ')}

    <!-- End Example Code -->
  </body>
</html>`

      StackBlitzSDK.openProject(
        {
          files: {
            'index.html': markup,
            'index.js': addJsSnippet ? jsSnippetContent : null,
          },
          title: 'Bootstrap Example',
          description: `Official example from ${window.location.href}`,
          template: addJsSnippet ? 'javascript' : 'html',
          tags: ['bootstrap'],
        },
        { openFile: 'index.html' }
      )
    })
  })
</script>
